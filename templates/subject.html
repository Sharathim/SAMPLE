<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Download free student notes for Tamil, English, Statistics, Java, HTML and more.">
    <title>{{ department.title() }} - Year {{ year }} - {{ semester.title() }} Semester | Notes Dock</title>
    <link rel="icon" href="{{ url_for('static', filename='assets/logo.png') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/subject.css') }}">
</head>

<body>
    <header class="header">
        <div class="header-brand">
            <img src="{{ url_for('static', filename='assets/logo.png') }}" alt="Notes Dock Logo" class="header-logo">
            <h1 class="site-title">Notes Dock</h1>
        </div>
        <nav class="header-nav">
            <a href="#about"><b>About</b></a>
            <a href="#contact"><b>Contact</b></a>
            <a href="#" onclick="openAdminModal(); return false;">
                <span class="footer-contact-icon"><i class="fa-solid fa-user-tie"></i></span>
                <b> Admin</b>
            </a>
        </nav>
    </header>
    
    <!-- Admin Modal -->
    <div class="admin-modal-overlay" id="admin-modal-overlay" aria-hidden="true">
        <div class="admin-modal" role="dialog" aria-modal="true" aria-labelledby="admin-modal-title">
            <div class="admin-modal-header">
                <button class="admin-close-btn" onclick="closeAdminModal()" aria-label="Close admin panel">
                    ×
                </button>
                <h2 class="admin-modal-title" id="admin-modal-title">Admin Panel</h2>
                <p class="admin-modal-subtitle">Year {{ year }} - {{ semester.title() }} Semester</p>
            </div>
            <div class="admin-modal-body">
                <div class="admin-error" id="admin-error" role="alert" aria-live="assertive" style="display: none;">
                    Invalid username or password. Please try again.
                </div>
                <form id="admin-form" onsubmit="handleAdminLogin(event)">
                    <div class="admin-form-group">
                        <label for="admin-username" class="admin-label">Username</label>
                        <input type="text" id="admin-username" name="username" class="admin-input"
                            placeholder="Enter your username" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="admin-password" class="admin-label">Password</label>
                        <input type="password" id="admin-password" name="password" class="admin-input"
                            placeholder="Enter your password" required>
                    </div>
                    <div class="admin-buttons">
                        <button type="button" class="admin-btn admin-btn-secondary" onclick="closeAdminModal()">
                            Cancel
                        </button>
                        <button type="submit" class="admin-btn admin-btn-primary">
                            Login
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <main class="main-content">
        <!-- Subject Header -->
        <div class="subject-header">
            <h1 class="subject-title">{{ department.title() }} - Year {{ year }}</h1>
            <p class="subject-subtitle">{{ semester.title() }} Semester Study Materials</p>
        </div>

        <!-- Subject Selection -->
        <div class="subject-selector">
            <div class="subject-tabs">
                {% for subject in subjects %}
                   <button class="subject-tab {% if loop.first %}active{% endif %}"
                    data-subject="{{ subject.name.lower().replace(' ', '-') }}"
                    onclick="showSubject('{{ subject.name.lower().replace(' ','-') }}')">
                    <i class="{{ subject.icon }}"></i>
        {{ subject.name }}
    </button>
{% endfor %}

                
                {% if not subjects %}
                    <div class="no-subjects-message">
                        <p>No subjects available for this semester yet.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Dynamic Subject Sections -->
        {% for subject in subjects %}
        <div id="{{ subject.name.lower().replace(' ', '-') }}-section" 
             class="subject-section {% if loop.first %}active{% endif %}">
            <div class="units-grid">
                {% if subject.units %}
                    {% for unit in subject.units|sort(attribute='number') %}
                    <div class="unit-card" data-unit-id="{{ unit.id }}">
                        <div class="unit-header">
                            <div class="unit-icon {{ subject.name.lower() }}">
                                <i class="{{ unit.icon }}"></i>
                            </div>
                            <div class="unit-number">{{ "%02d"|format(unit.number) }}</div>
                        </div>
                        <h3 class="unit-title">{{ unit.title }}</h3>
                        <p class="unit-description">{{ unit.description }}</p>
                        <div class="unit-stats">
                            <span>{{ unit.topics.split(',') | length if unit.topics else 0 }} topics</span>
                            <span>{{ unit.pages_count }} pages</span>
                        </div>
                        <div class="unit-topics">Topics: {{ unit.topics or 'Not specified' }}</div>
                        {% if unit.filename %}
                            <button class="download-btn" onclick="downloadUnit('{{ unit.filename }}', '{{ unit.title }}')">
                                <i class="fas fa-download"></i> Download Unit {{ unit.number }}
                            </button>
                        {% else %}
                            <button class="download-btn" disabled>
                                <i class="fas fa-download"></i> File Not Available
                            </button>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="no-units-message">
                        <div class="no-units-icon">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <h3 class="no-units-title">No units available yet</h3>
                        <p class="no-units-description">Units for {{ subject.name }} haven't been added yet. Check back later!</p>
                    </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </main>

    <!-- Site Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-column">
                    <h3 id="about">About Us</h3>
                    <p>Your ultimate destination for comprehensive study materials. We provide high-quality notes across
                        multiple subjects to help students excel in their academic journey. Download, learn, and succeed
                        with Notes Dock. We built Notes Dock with a simple yet powerful mission: to make learning smarter,
                        sharing easier, and knowledge accessible to everyone.</p>
                    <div class="social-links">
                        <a href="mailto:notesdock143@gmail.com" class="social-link" title="Email us">
                            <i class="fa-solid fa-envelope"></i>
                        </a>
                        <a href="https://instagram.com/notes_dock_ig" class="social-link" title="Follow us on Instagram"
                            target="_blank">
                            <i class="fa-brands fa-instagram"></i>
                        </a>
                        <a href="https://github.com" class="social-link" title="Follow us on GitHub" target="_blank">
                            <i class="fa-brands fa-github"></i>
                        </a>
                        <a href="https://linkedin.com" class="social-link" title="Connect on LinkedIn" target="_blank">
                            <i class="fa-brands fa-linkedin"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>⏰ 24/7 Support Available</p>
                <p>&copy; 2025 Notes Dock. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Admin Functions
        function openAdminModal() {
            const modal = document.getElementById('admin-modal-overlay');
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            document.getElementById('admin-username').focus();
        }

        function closeAdminModal() {
            const modal = document.getElementById('admin-modal-overlay');
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            document.getElementById('admin-form').reset();
            document.getElementById('admin-error').style.display = 'none';
        }

        async function handleAdminLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const errorDiv = document.getElementById('admin-error');
            
            try {
                const response = await fetch('/admin/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    window.location.href = '/admin';
                } else {
                    errorDiv.textContent = result.message;
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'Login failed. Please try again.';
                errorDiv.style.display = 'block';
            }
        }

        // Subject switching functionality
        function showSubject(subjectName) {
            // Hide all sections
            document.querySelectorAll('.subject-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.subject-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected section
            const section = document.getElementById(`${subjectName}-section`);
            if (section) {
                section.classList.add('active');
            }

            // Add active class to selected tab
            const activeTab = document.querySelector(`[data-subject="${subjectName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }

            // Trigger animations
            setTimeout(() => {
                const cards = section?.querySelectorAll('.unit-card');
                if (cards) {
                    cards.forEach((card, index) => {
                        card.style.animationDelay = `${index * 0.1}s`;
                        card.style.animation = 'none';
                        card.offsetHeight; // Trigger reflow
                        card.style.animation = 'fadeInUp 0.6s ease forwards';
                    });
                }
            }, 100);
        }

        // Download functionality
        async function downloadUnit(filename, unitTitle) {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<div class="loading"></div> Downloading...';
            button.disabled = true;
            
            try {
                const response = await fetch(`/download/${filename}`);
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    showToast(`Downloaded ${unitTitle} successfully!`, 'success');
                } else {
                    showToast('Download failed. Please try again.', 'error');
                }
            } catch (error) {
                showToast('Download failed. Please try again.', 'error');
            }
            
            button.innerHTML = originalText;
            button.disabled = false;
        }

        // Toast notification system
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : '#ef4444'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 0.5rem;
                box-shadow: var(--shadow-lg);
                z-index: 5000;
                opacity: 0;
                transform: translateY(-20px);
                transition: all 0.3s ease;
                font-family: inherit;
                font-size: 0.9rem;
                font-weight: 500;
                max-width: 300px;
                word-wrap: break-word;
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateY(0)';
            }, 100);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Show first subject by default if available
            const firstTab = document.querySelector('.subject-tab');
            if (firstTab) {
                const firstSubject = firstTab.dataset.subject;
                showSubject(firstSubject);
            }
        });
    </script>
</body>

</html>